[build]
builder = "NIXPACKS"
buildCommand = "npm run build"

[deploy]
startCommand = "npm start"
restartPolicyType = "ON_FAILURE" 
restartPolicyMaxRetries = 10

[environments.production.variables]
NODE_ENV = "production"
PORT = "3000"

# AWS S3 Configuration - Set these in Railway Variables UI
AWS_REGION = "us-east-1"
S3_BUCKET = "figma-capture-assets"
S3_ASSET_EXPIRY_HOURS = "24"

# Security - Set these in Railway Variables UI
API_KEY_REQUIRED = "true"

# Railway managed services (auto-populated)
REDIS_HOST = "${{REDIS.PRIVATE_URL}}"
API_BASE_URL = "${{RAILWAY_STATIC_URL}}"

# Rate Limiting
RATE_LIMIT_WINDOW_MS = "900000"
RATE_LIMIT_MAX_REQUESTS = "100"

# Worker Configuration
WORKER_CONCURRENCY = "2"
CAPTURE_TIMEOUT_MS = "90000"
BROWSER_HEADLESS = "true"
BROWSER_ARGS = "--no-sandbox,--disable-setuid-sandbox,--disable-dev-shm-usage"

# Job Configuration
JOB_RETENTION_DAYS = "7"
JOB_MAX_ATTEMPTS = "3"

# Logging
LOG_LEVEL = "info"
LOG_PRETTY = "false"